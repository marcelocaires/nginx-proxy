# traefik.yml
version: '3.8'

services:
  traefik:
    image: traefik:v2.10
    container_name: traefik_proxy
    restart: always
    
    command:
      # --- Configuração Geral ---
      - --providers.docker=true
      - --providers.docker.exposedbydefault=false # Apenas contêineres com label 'traefik.enable=true' serão roteados
      
      # --- Entrypoints (Portas de Entrada) ---
      - --entrypoints.web.address=:80        
      - --entrypoints.websecure.address=:443  
      
      # --- Configuração do Certificados (Let's Encrypt - ACME) ---
      - --certificatesresolvers.letsencrypt.acme.tlschallenge=true # Usa desafio TLS-ALPN-01 (na porta 443)
      - --certificatesresolvers.letsencrypt.acme.email=seu-email@dominio.com # *** MUDAR ESTE EMAIL! ***
      - --certificatesresolvers.letsencrypt.acme.storage=/etc/traefik/acme.json 

    ports:
      - "80:80"    
      - "443:443"  

    volumes:
      # Volume para persistência dos certificados (dados do Certbot)
      - traefik_data:/etc/traefik 
      # Monta o socket do Docker para Traefik monitorar os labels
      - /var/run/docker.sock:/var/run/docker.sock:ro 

    labels:
      # O Traefik não precisa de roteamento para si mesmo
      - "traefik.enable=false"
    
    networks:
      - web

networks:
  web:
    external: true # Conecta-se à rede 'web' que você criou
    
volumes:
  traefik_data: